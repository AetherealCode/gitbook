---
description: 'xakep.ru | 19 Октябрь 2013 03:17'
---

# Flamer

## Flamer — самая сложная вирусная угроза последнего времени 

  
W32.Flamer, она же sKyWIper, она же Flame, — каждый по-своему называет эту сложнейшую разработку. На мой взгляд, более адекватно отражает цель, преследуемую заказчиком, первое имя \(не «скандалист», а «поджигатель»\). Так я и буду дальше его называть. Его? Нет, ее. Конечно, Flamer можно окрестить вирусом или червем, но для такой масштабной разработки это как-то мелковато. Пусть уж будет угроза, то есть — «она».  
Итак, маркетинговые баталии вперемешку с отрывочными техническими описаниями Flamer отгремели, и все стихло. Разумеется, создателям, а точнее, заказчикам Flamer это на руку — проще будет запустить что-то новое. Но просто забыть о такой беспрецедентной программной разработке было бы неправильно. Поэтому я хочу свести основные и наиболее интересные детали воедино, чтобы позже не искать их на разных ресурсах.  


### ПЕРВОИСТОЧНИКИ, ИЛИ КТО И КОГДА ОБНАРУЖИЛ 

Начну с самого начала — с обнаружения. Существует три версии, а значит, и три претендента на первенство. Кто был первый, на мой взгляд, не принципиально, главное, что он есть, а также и второй, и третий. Значит, нашей с вами защитой занимаются, и можно чувствовать себя более-менее спокойно.  
28 мая 2012 года MAHER — иранский национальный центр реагирования на чрезвычайные ситуации \([Iran National CERT](http://www.certcc.ir/index.php?newlang=eng)\), занимавшийся с 2010 года исследованием не менее известных Stuxnet и Duqu, сообщил об обнаружении новой угрозы — Flamer, которая не детектировалась на то время ни одним из 43 антивирусных продуктов. В [сообщении](http://bit.ly/LL9NTu) был приведен списком основной функционал, добавляемый в реестр ключ и базовые компоненты — имена файлов с их расположением в файловой системе.  
В этот же день, 28 мая, «Лаборатория Касперского» заявила об обнаружении угрозы Flame в рамках исследования, проводившегося по заказу International Telecommunication Union \(ITU\), с ее кратким словесным описанием.  
Практически одновременно с этим, также 28 мая 2012 года, Лаборатория криптографии и систем безопасности Будапештского университета технологий и экономики \(Laboratory of Cryptography and System Security, CrySyS Lab, [www.crysys.hu](http://www.crysys.hu/)\), тесно взаимодействующая с компанией Symantec, опубликовала новость об обнаружении новой угрозы, названной[sKyWIper](http://www.crysys.hu/skywiper-statement.html). Также был опубликован технический отчет \([вер. 1.03](http://www.crysys.hu/skywiper/skywiper.pdf)\), содержащий 62 страницы ее описания, включая состав модулей, даты создания, сопоставление с Duqu и Stuxnet, взаимодействие ее компонентов между собой и с C&C-центром, поведение и многое другое. Чуть позже там же появилось пояснение, что sKyWIper — это то же самое, что и Flame \(«Лаборатория Касперского»\) и Flamer \(MAHER\).  
На сайте компании Symantec информация о появлении новой угрозы — [Flamer](http://www.symantec.com/en/uk/security_response) появилась 27.05.2012 в 19:00 \(UTC\).  
В дальнейшем компании «Лаборатория Касперского» и Symantec продолжили публикацию технических подробностей Flamer в своих блогах.  
Первоисточники указаны — каждый может воспользоваться любым из них \(или всеми\). А я выбрал тот, что мне ближе \(не важно, по каким соображениям\).  


### КРАТКОЕ ОПИСАНИЕ 

Flamer — это сложная, я бы даже сказал изощренная угроза, присутствующая в интернете как минимум с 2010 года. Она наиболее распространена в странах Ближнего Востока и нацелена прежде всего на конкретных индивидуумов, а не на организации. Основная цель — кража разнообразных данных и самораспространение в определенной среде. Есть достаточные основания полагать, что Flamer и Stuxnet — родственные продукты.  
Flamer — грамотно спроектированная угроза, включающая в себя большое количество компонентов, что могло быть выполнено лишь группой профессионалов высокой квалификации в рамках хорошо финансируемого и четко управляемого проекта. Она включает в себя веб-сервер, SQL базу данных и библиотеку реализации протокола SSH. И помимо всего этого она включает в себя Lua-интерпретатор, который позволяет злоумышленнику легко расширять ее функциональность по мере необходимости.  


#### Сбор информации 

Flamer — это громадная, в прямом и переносном смысле, угроза хищения информации. Она нацелена на широкий спектр информации на зараженных компьютерах и выполняет свою задачу лучше любого другого ранее выявленного аналога. Различные модули собирают информацию с различных источников; некоторые активируются, только если предварительно обнаружена информация, интересная злоумышленникам. Угроза способна извлекать метаданные из файлов, например, она может извлечь GPS-координаты из фотографий или имена авторов документов. Информация шифруется и сохраняется в локальной SQLight базе данных или в папке «%Temp%» для последующей обработки.  
Если обнаруживается программное обеспечение синхронизации мобильного телефона компаний Sony Ericsson или Nokia, Flamer также похищает соответствующие файлы данных.  
Заражению Flamer подвержены лишь компьютеры под управлением семейства ОС Microsoft Windows. Для распространения на другие компьютеры Flamer применяет целый ряд методов. Она может распространяться через сетевые ресурсы общего доступа, используя для этого украденные учетные записи, и через сменные носители информации, используя механизм автозапуска autorun.inf. Она также эксплуатирует две уязвимости — CVE-2010-2568, впервые продемонстрированную Stuxnet, и CVE-2010-2729. Помимо этого, Flamer применяет атаку «человек посередине» \(a man-in-the-middle, MITM\), направленную на службу обновления Windows Update. Для ее осуществления злоумышленники предварительно провели атаку, прибегнув к ранее неизвестному конфликту обработки записей по протоколу MD5, и использовали сертификат, позволивший подписать программный код и внести его в Microsoft Root Authority.  


### ТЕХНИЧЕСКОЕ ОПИСАНИЕ 

#### **Хронология и распространение** 

Flamer состоит из нескольких компонентов. Изучив отчеты и конфигурационный файл одного из основных, можно определить цели Flamer и установить частичную хронологию. Файлы компонентов:

* advnetcfg.ocx,
* ccalc32.sys,
* mssecmgr.ocx ,
* msglu32.ocx,
* boot32drv.sys,
* nteps32.ocx. 

Были обнаружены два варианта файла advnetcfg.ocx. Первый датирован сентябрем 2010 года, второй появился в феврале 2011-го. Конфигурационный файл ccalc32.sys также имел два варианта, каждый из которых появился в то же время, что и файл advnetcfg.ocx.  
Количество заражений Flamer невелико, что лишь подчеркивает острую направленность угрозы. Менее 150 заражений было выявлено глобально, большей частью на Ближнем Востоке — см. рис 1. Интересно, что в дополнение к определенным организациям было заражено много домашних компьютеров, подключенных к интернету.  
![](data:text/xml;base64,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)  
Рис.1. География Флеймера  


**Подробное описание**  


Flamer — это сложная и хорошо спроектированная угроза, состоящая из платформы, включающей помимо прочего веб-сервер, сервер баз данных и среду защищенного удаленного взаимодействия. Она изначально представляет собой инсталляционный пакет размером 6 мегабайт, разворачивающийся примерно в 20 мегабайт кода и данных. Угроза также включает в себя Lua-интерпретатор, позволяющий злоумышленнику легко установить обновление функционала, используя различные сценарии выполнения \(скрипты\). Было выявлено 62 скрипта, обеспечивающих выполнение самых различных действий, включая возможность загрузки новых модулей с C&C-сервера или обновления существующих. Несколько компонентов созданы таким образом, что они на первый взгляд не выглядят вредоносными — ни по используемым данным, ни по строкам программного кода.  
![](data:text/xml;base64,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)  
Основной файл и первый элемент угрозы Flamer, запускаемый на зараженном компьютере, — это mssecmgr.ocx. Он содержит множество подкомпонентов, состав и основное предназначение основных из них представлены на рис 3.  
![](data:text/xml;base64,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)  
Большинство подкомпонентов, включая различные скрипты, хранятся в зашифрованном ресурсном контейнере, встроенном в mssecmgr.ocx. Этот ресурсный контейнер включает в себя таблицу, которая при старте отображает список точек входа и далее функционирует как индексный указатель данных — некий аналог файловой системы. Так же как и на скрипты, таблица размещения ресурсов содержит ссылки и на несколько самостоятельных исполняемых DLL-файлов библиотек: advnetcfg.ocx, nteps32.ocx, boot32drv.sys, msglu32.ocx, soapr32.ocs, jimmy.dll, 00006411.dll и другие.  
За пределами ресурсного контейнера в файле присутствует код, обеспечивающий функционирование HTTP-сервера, SOCKS-прокси, SSH, SQLite и, разумеется, Lua-интерпретатора. Lua — это легкий сценарный язык, который был создан специально для внедрения в приложения. Скрипты, написанные на нем, могут использовать функционал программы, в которую они встроены. С помощью Lua злоумышленник уменьшает трудозатраты, необходимые для разработки нового функционала для Flamer.  
Когда mssecmgr.ocx запускается, он использует несколько трюков, чтобы внедрить себя в работающую систему.  
Во-первых, он распаковывает и запускает advnetcfg.ocx, который загружает и расшифровывает данные из файла ccalc32.sys. Файл ccalc32.sys зашифрован алгоритмом RC4 со 128-разрядным ключом. Затем создается файл ccalc32.sys, которому задним числом устанавливаются метки времени, аналогичные системному файлу Windows kernel32.dll, с целью скрыть от пользователя появление нового файла. Файл advnetcfg.ocx также отвечает за обработку команд, отправляемых другими компонентами.  
Затем файл mssecmgr.ocx передает nteps32.ocx в advnetcfg.ocx, который проводит инъекцию nteps32.ocx в чистый файл shell32.dll. При первой же \(и единственной\) загрузке он подменяет DLL-библиотеку в памяти на вредоносную, проводит инъекции в winlogon.exe или другие выбранные процессы — множественные блоки кода вставляются и вызываются по необходимости.  
Основной модуль регистрирует себя в реестре Windows следующим ключом, обеспечивающим его запуск при старте Windows:  


> HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\"Authentication Packages" = "mssecmgr.ocx"

Одновременно с запуском nteps32.ocx mssecmgr.ocx запускает основной сценарий Lua. Скрипт начинает работу с поиска обновлений для приложений из базы приложений. \(В программном коде хранилище приложений имеет ссылочное имя FLAME.\) Он также имеет возможность загрузить новое приложение в хранилище. После этого он создает несколько файлов баз данных для хранения похищенных данных и запускает на выполнение другие скрипты.  
Вот несколько примеров из них \(набор скриптов верхнего уровня был поврежден, что дает нам с вами возможность пофантазировать за рамками представленного описания\):  


* ATTACKOP — атака другого компьютера и перенесение на него используемых технологий и эксплойтов;
* CASAFETY — проверка на наличие антивирусного программного обеспечения;
* CRUISE — кража учетных данных;
* EUPHORIA — распространение через LNK-уязвимости и точки подключения папок;
* BEETLEJUICE — Bluetooth-обнаружение;
* SUICIDE — удаление файлов Flamer из системы;
* MUNCH — HTTP-сервер;
* VIPER — бэкдор;
* FLASK — кража локальной информации;
* MICROBE — запись аудиофайлов со встроенного микрофона;
* GATOR — взаимодействие с C&C-сервером. 

Часть скриптов зависит от дополнительных исполняемых файлов. Например, скрипт ATTACKOP может вызывать файл soapr32.ocx. Этот файл похищает ряд сетевых данных с локального компьютера и затем записывает их в файл, зашифрованный алгоритмом RC4. Также есть модуль, который проверяет на наличие установленных и запущенных продуктов обеспечения безопасности. В зависимости от результата модуль может адаптировать поведение угрозы с целью минимизации риска ее обнаружения.  
Файл mssecmgr.ocx также ссылается на файл ~DEB93D.tmp, который ассоциирован с вирусом Wiper, «отключившим» несколько нефтяных терминалов в Иране от интернета. Имя Wiper он получил за счет встроенной функциональности стирания информации с жестких дисков. И эта атака вполне могла быть проведена при помощи одного из модулей Flamer.  


### **Заражение и самораспространение** 

#### **Начальный вектор** 

В настоящее время неизвестно, как именно угроза в первый раз попала на целевые компьютеры. Обычно при проведении целевых атак с помощью технологий социальной инженерии отправляется письмо, содержащее зараженное вложение или ссылку на веб-сайт с источником заражения. В данном случае это возможно, но скорее всего был использован другой сценарий. Учитывая способность Flamer распространяться через зараженные USB-устройства, можно допустить, что специально подготовленные \(зараженные\) устройства были физически доставлены в стратегические регионы.  


#### **Сетевое распространение**

Flamer имеет возможность самораспространения с одного компьютера на другой по сети. Однако Flamer не распространяется автоматически. Вместо этого она ждет инструкций атакующего, после чего использует следующие сценарии:  


* через ресурсы общего доступа, используя похищенные учетные данные, включая учетные записи администраторов домена; 
* через уязвимость Microsoft Windows Print Spooler Service Remote Code Execution Vulnerability \(CVE-2010-2729\), до этого использованную Stuxnet; 
* через сменные носители информации, используя специально подготовленный файл “autorun.inf”, до этого уже использованный Stuxnet; 
* через внешние диски — используя специальный каталог, в котором спрятаны файлы, и возможность их автозапуска при просмотре USB-устройства, в сочетании с уязвимостью Microsoft Windows Shortcut 'LNK/PIF' Files Automatic File Execution Vulnerability \(CVE-2010-2568\), до этого использованную Stuxnet; 
* через запросы на обновления Windows Update и атаку «человек посередине» \(MITM\). 

Почти все эти методы типичны и ранее могли быть использованы другими вредоносными программами, за исключением двух последних методов, которые представляют собой нечто такое, что еще не встречалось.

####  **Распространение через USB и точки подключения**

  
Точки подключения — это возможность Windows, позволяющая пользователю создавать ссылки на каталог. Например, если есть достаточно длинный путь, такой как «C:\My\Very\Long\Directory\Path», то точку подключения к нему можно назвать «C:\MyJunction», что упрощает его использование. Такая точка подключения сама по себе является папкой со специальными атрибутами. Flamer использует точки подключения для того, чтобы спрятать в них файлы и обеспечить их автозапуск. Для этого она создает обычную папку на съемном диске, названия ее могут быть различными, например «My Docs». Внутрь этой папки Flamer помещает три файла:

* себя самого, разумеется, например mssecmgr.ocx,
* desktop.ini,
* target.lnk.

Desktop.ini — специальный конфигурационный файл Windows, позволяющий пользователю изменять свойства и поведение папки. Flamer добавляет секцию ShellClassInfo в конфигурационный файл desktop.ini, объявляя его в качестве точки подключения. Обычно точка подключения лишь ссылается на другую папку — пользователь не может в качестве точки подключения указать исполняемый файл, так как вместо подключения и открытия папки произойдет запуск этого файла.  
Flamer использует некоторые уловки для изменения этого поведения. Три точки входа со специально выбранными CLSID добавляются в секцию ShellClassInfo.  
Эти CLSID представляют папку «My Docs» как точку подключения, но вместо перенаправления на другую папку подставляется ссылка на файл target.lnk, который должен быть внутри этой же папки.  
Теперь, если пользователь попытается открыть папку «My Docs», используя Windows Explorer, этого не произойдет, а пользователь будет перенаправлен в папку, указанную в target.lnk. Это означает, что пользователь не увидит файлы внутри «My Docs», то есть target.lnk и desktop.ini, но что более важно — он не увидит и не получит доступа к Flamer \(mssecmgr.ocx\). Таким способом Flamer скрывает себя внутри точки подключения.  
Но это лишь полдела — скрытая от пользователя в точке подключения Flamer нуждается в механизме автозапуска. Так как файл .lnk уже используется, Flamer \(как ранее Stuxnet\) эксплуатирует уязвимость Microsoft Windows Shortcut 'LNK/PIF' Files Automatic File Execution Vulnerability \(CVE-2010-2568\). Для этого специально создается файл target.lnk, обеспечивающий автозапуск Flamer и, соответственно, инфицирование компьютера. Как только удаленный диск подключается и начинает просматриваться, Windows автоматически обрабатывает точку подключения, запуская файл, указанный в target.lnk \(mssecmgr.ocx\). Этот заключительный шаг запускает Flamer и позволяет ей инфицировать компьютер.

1. Когда подключается зараженный внешний носитель, пользователь видит папку, но не может в нее заглянуть.
2. Windows автоматически открывает папку и обрабатывает файлы, находящиеся внутри.
3. Flamer запускается через lnk-файл, эксплуатируя уязвимость ссылок.

**Атака man-in-the-middle \(MITM, человек посередине\) на Windows Update**

  
Flamer способна использовать довольно интересный метод атаки на функцию Windows Update для самораспространения по локальной сети. В процесс доставки фальшивого обновления вовлечены три его компонента: SNACK, MUNCH и GADGET.  
Когда запускается Internet Explorer, он по умолчанию автоматически проверяет заданную конфигурацию прокси-сервера. Это происходит посредством Web Proxy Auto-Discovery Protocol \(WPAD\). Internet Explorer пробует получить данные \(wpad.dat\) на основе доменного имени компьютера. Например, если компьютер имеет имя «[computerA.group.company.com](http://computera.group.company.com)», Internet Explorer будет запрашивать wpad.dat со следующих узлов:

* [wpad.group.company.com](http://wpad.group.company.com),
* [wpad.company.com](http://wpad.company.com).

Обычно разрешение этих имен в IP-адрес происходит на сервере DNS. Однако если DNS-сервер не содержит этих зарегистрированных записей, Internet Explorer будет также использовать для разрешения имен WINS и NetBIOS.  
Разрешение имен NetBIOS позволяет компьютерам находить друг друга в локальной сети на основе peer-to-peer модели взаимодействия, то есть без центрального сервера. Каждый компьютер просто рассылает широковещательные сообщения своего имени для обеспечения собственной идентификации. Разумеется, это небезопасно, и компьютеры, используя эту возможность, могут «обманывать» друг друга.  
SNACK выполняет ряд функций, включая сниффинг NetBIOS-запросов в локальной сети. Когда клиенты пытаются разрешить имя компьютера в сети и выполнить WPAD-запрос, Flamer уведомляет их, что он является WPAD-сервером, и предоставляет им поддельный файл WPAD-конфигурации \(wpad.dat\). Подобные атаки на NetBIOS WPAD — хорошо известная техника, и многие доступные утилиты ее используют.  
Когда еще не зараженный компьютер получает поддельный файл wpad.dat, он использует в качестве прокси-сервера компьютер, инфицированный Flamer. После этого весь его веб-трафик будет сначала отправляться на этот зараженный компьютер.  
Компонент MUNCH — это веб-сервер внутри Flamer, и он принимает перенаправленный трафик. MUNCH проверяет в нем наличие различных запросов, включая совпадение URL-ссылок с Windows Update. Как только оно обнаруживается, атака MITM начинается.  
Мошенничество с Windows Update нетривиально, так как обновления должны быть подписаны Microsoft. Однако Flamer обошел это ограничение, используя сертификат, связанный с Microsoft Root Authority и ошибочно разрешающий подписание кода. Это произошло благодаря бреши в сервере Microsoft Terminal Server Licensing. Как часть процесса активации Microsoft выпускает сертификат для сервера Terminal Services Licensing, позволяющий Microsoft отслеживать права пользования сервером Terminal Services. Эти сертификаты являются авторизованными Microsoft Enforced Licensing Intermediate PCA, который, в свою очередь, авторизован Microsoft Root Authority. Эти выпущенные сертификаты являются сертификатами ограниченного использования, но позволяют подписывать ими код. Это дало Flamer возможность подписать компонент и сделать его как бы распространяемым от имени Microsoft. \(Компания Microsoft выпустила бюллетень Security Advisory 2718704 и соответствующее обновление, которое устраняет эту уязвимость и отзывает сертификаты, о которых здесь идет речь.\)  
Подписанный таким образом бинарник способен пройти верификацию на системах Windows XP, но отклоняется системами Windows Vista и Windows 7 с момента выпуска Microsoft расширения Hydra. Поэтому злоумышленники предпочли использовать ранее неизвестный метод, вызывающий конфликт обработки MD5. Затратив сравнительно небольшие усилия, они могут вызвать конфликт обработки MD5 в процессе получения действительного сертификата, нужного для бинарника.  
Когда Flamer получает запрос на Windows Update, модуль GADGET через MUNCH предоставляет бинарник, подписанный действующим сертификатом, позиционирующим себя в качестве порождения Microsoft. Бинарник загружается и запускается на незараженном компьютере так, как если бы он был официальным обновлением Windows Update. Этот бинарник еще не Flamer, но это ее загрузчик. Один из образцов бинарника ссылается на себя как TumblerEXE.exe.  
Tumbler сначала проводит ряд проверок системной информации и сетевых интерфейсов, включая установленные продукты информационной безопасности. Если Tumbler полагает, что инфицирование возможно, то он связывается с компьютером, зараженным Flamer, по HTTP по URL-ссылке следующего вида:  


> \[http://\]MSHOME-&lt;STRING&gt;/view.php?mp=1&jz=&lt;STRING&gt;&fd=&lt;STRING&gt;&am=&lt;STRING&gt;&ef=&lt;STRING&gt;&pr=&lt;STRING&gt;&ec=&lt;STRING&gt;&ov=&lt;STRING&gt;&dd=&lt;STRING&gt;

Приложение MUNCH зараженного Flamer компьютера в ответ отправляет mssecmgr.ocx, и Tumbler сохраняет его как %Windir%\temp\~ZFF042.tmp и затем запускает. Имя этого файла может отличаться для различных образцов. После его запуска компьютер становится инфицированным Flamer.  


**Bluetooth**  


Flamer — единственная из Windows-угроз, использующая Bluetooth. Данная функциональность реализуется модулем BeetleJuice, который подключается конфигурационными параметрами, задаваемыми злоумышленником. Когда он включен, то выполняет две основные задачи.  
Первая — сканирование с целью обнаружения всех доступных Bluetooth-устройств. При обнаружении устройства модуль опрашивает его статус и записывает детальную информацию о нем, включая идентификатор, для последующей отправки злоумышленнику.  
Вторая — самоконфигурация в качестве Bluetooth-маяка. Это означает, что компьютер, зараженный Flamer, будет «отсвечивать», когда любое другое Bluetooth-устройство сканирует окружающее пространство. В дополнение к Bluetooth-маяку Flamer шифрует информацию об инфицированном компьютере и затем сохраняет ее в специальном поле «description». Когда любое другое устройство сканирует Bluetooth-окружение, это поле ему будет доступно.  
Нет однозначного представления о том, для чего именно собирается Bluetooth-информация. Один из вариантов объяснения — чтобы, отслеживая присутствие мобильных устройств в ближайшем окружении жертвы, получить карту социальной сети. Bluetooth-маяк также может быть использован для определения физического месторасположения зараженного компьютера, так как радиоволны маяка могут быть обнаружены чувствительной антенной неподалеку. Получаемая таким образом информация может также быть использована для отслеживания перемещений выбранного пользователя \(в случае заражения мобильного компьютера и/или отслеживания перемещения его телефона\) и ведения аудиозаписи переговоров людей, находящихся поблизости.  


**C&C-сервер**  


Выявлено более 80 доменов, используемых в качестве C&C-серверов, включающих небольшие группы, привязанные к одному IP-адресу. Все домены были зарегистрированы на подставных \(сфабрикованных\) лиц — владельцев из различных стран.  
В начале июня 2012 года C&C-серверы, которые еще не были выявлены, отправили команду самоуничтожения инфицированным клиентам — загрузить файл browse32.ocx, ответственный за удаление Flamer с инфицированного компьютера. Файл имеет временной штамп от 09 мая 2012 года. Модуль browse32.ocx имеет две части:  


1. EnableBrowser — это инициатор, задающий окружение \(семафоры, события, общие блоки памяти и другин\) до начала выполнения действий. 
2. StartBrowse — это часть кода, которая реально удаляет компоненты Flamer. 

Модуль содержит обширный список файлов и папок, используемых Flamer. Он находит каждый файл на диске, удаляет его и последовательно перезаписывает освобожденное дисковое пространство случайным набором символов, препятствуя обнаружению информации об инфицировании. Этот компонент содержит программу генерации случайных чисел, используемую в результате перезаписи. Он пытается не оставить следов о произошедшем ранее инфицировании.  
Интересно, что загружался специальный компонент, в то время как Flamer уже содержала компонент SUICIDE с аналогичной функциональностью. Неясно, почему авторы угрозы решили не использовать функциональность SUICIDE, а вместо этого нагрузили Flamer выполнением подобной задачи на основе нового модуля.  


### ЗАКЛЮЧЕНИЕ

Конечно, хотелось бы поместить подобные угрозы в своеобразную клетку — в «песочницу», виртуально моделирующую различные системы для изучения их поведения, но увы… мечты, мечты… А пока остается лишь использовать в обязательном порядке передовые продукты информационной безопасности в \(обязательно!\) актуальном состоянии и ни в коем случае не пренебрегать обновлениями безопасности. Удачи на просторах интернета!  


### Информация, которой очень интересуется Flamer 

**Информация о системе:**  


* Имя компьютера
* Исполняющиеся процессы
* Службы
* Свойства сменных носителей информации
* Зарегистрированные устройства
* Информация о временной зоне \(часовом поясе\)
* Информация о принтере Сетевая информация:
* IP-адрес и настройки
* Настройки Gateway
* Настройки Proxy
* Подключённые принтеры
* Настройки DHCP
* Информация DNS
* Информация таблицы маршрутизации
* Сетевые карты и интерфейсы
* Содержимое файла Hosts
* Имя узла
* Настройки сервера почты
* Информация об удалённых подключениях к Интернету
* Имя и параметры Wi-Fi-сети
* Открытые порты
* Открытые соединения 

**Профили и кэшируемые параметры учётных записей:**  


* Учётные данные компьютера
* Microsoft Outlook
* Remote Access Services
* CoreFTP
* CureFTP
* EmFTP
* FTP Explorer
* Mssh
* NetserveFTP
* RAdmin
* RoboFTP
* Softx FTP
* South River WebDrive
* TeamViewer
* VNC

**Данные пользователя и окружения:**  


* Снимки экрана
* Запись видео
* Запись аудио
* История просмотров
* Свойства Bluetooth-устройств, расположенных в зоне досягаемости
* Имена близлежащих компьютеров
* Другие детали об удалённых компьютерах
* Список папок и файлов 

**Файлы:**  


* Документы Microsoft Word
* Презентации Microsoft PowerPoint
* Таблицы Microsoft Excel
* Файлы Microsoft Publisher
* Письма Microsoft Outlook Express
* Заметки Microsoft Outlook
* Назначенные Microsoft Outlook appointments
* Приглашения на встречи Microsoft Outlook
* Диаграммы Microsoft Visio
* Базы данных Microsoft Access
* Проектные данные AutoCAD
* PDF-файлы
* Изображения JPEG
* Изображения Bitmap
* Изображения TIFF
* Изображения PNG
* Изображения GIF
* URL-ссылки
* .CSV-файлы
* .LNK-файлы
* .ORA-файлы
* .RDP-файлы
* .RTF-файлы
* .SSH-файлы
* .SSH2-файлы
* .TXT-файлы 

**Метаданные файлов:**  


* Общая информация
* Заголовок
* Исполнитель
* Компания
* Комментарии
* Автор
* Владелец
* Дата создания
* Дата изменения
* Расширения
* Версии
* Ключевые слова
* Руководитель
* Кем внесено последнее изменение
* GPS-широта
* GPS-долгота
* GPS-высота
* Дата создания
* Производитель камеры
* Модель камеры
* Расширения
* Информация о размере
* Информация о сжатии 

**Установленные приложения:**  


* Ace FTP
* BitKinex
* Bulletproof FTP
* CyD FTP
* Dameware
* Innosetup
* Intersoft SecureKeyAgent
* Ipswitch WSFTP
* JaSFTP
* Jildi FTP
* Netserve FTP
* PenguiNet
* RageWork
* SecureCRT
* SmartFTP
* VNC 

**Мониторинг сетевого трафика:**  


* NetBIOS/SMB
* Yahoo mail
* Yahoo Rocketmail
* Yahoo Maktoob
* Gawab
* Google mail
* Microsoft Live
* Microsoft Hotmail
* Домены, начиная с почтового адреса. 

Original Page: [https://xakep.ru/2013/10/19/flamer-samaya-slozhnaya-virusnaya-ugroza-poslednego-vremeni/](https://xakep.ru/2013/10/19/flamer-samaya-slozhnaya-virusnaya-ugroza-poslednego-vremeni/)  


